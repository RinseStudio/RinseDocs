---
import { twMerge } from 'tailwind-merge';
const { className = null, ...props } = Astro.props;
---

<div
  x-data="Tab"
  class={twMerge(
    'relative flex items-center gap-3 px-3 border-b border-gray-200 before:absolute before:-bottom-px before:left-[var(--tab-offsetLeft)] before:h-[2px] before:w-[var(--tab-offsetWidth)] before:bg-blue-500 before:duration-300 dark:border-zinc-700 dark:before:bg-blue-400',
    className,
  )}
>
  <slot />
</div>

<script>
  import Alpine from 'alpinejs';
  import anchor from '@alpinejs/anchor';

  document.addEventListener('alpine:init', () => {
    Alpine.data('Tab', () => ({
      buttonWidth: 20, // Default width
      buttonLeft: 20, // Default left position

      init() {
        const activeTab = this.$root.querySelector('[data-tab-active]');
        // console.log(activeTab.offsetWidth);
        if (activeTab) {
          // Set custom properties based on the first button's width and left position
          const buttonLeft = activeTab.offsetLeft;
          const buttonWidth = activeTab;
          console.log(activeTab.offsetWidth);
          console.log('loaded');
          this.$root.style.setProperty('--tab-offsetLeft', `${buttonLeft}px`);
          this.$root.style.setProperty('--tab-offsetWidth', `${buttonWidth}px`);
        }
      },
      updateIndicatorPosition() {
        this.$root.style.setProperty('--tab-offsetWidth', `${this.buttonWidth}px`);
        this.$root.style.setProperty('--tab-offsetLeft', `${this.buttonLeft}px`);
      },
      link(url) {
        window.location.href = url;
      },
      switchTab() {
        this.buttonWidth = this.$el.offsetWidth;
        this.buttonLeft = this.$el.offsetLeft;

        const tabs = this.$root.querySelectorAll('button');
        tabs.forEach((tab) => {
          tab.removeAttribute('data-tab-active');
          tab.classList.remove('text-blue-500', 'dark:text-blue-400');
          tab.classList.add('text-gray-400', 'hover:text-gray-600', 'dark:hover:text-gray-300');
        });
        this.$el.setAttribute('data-tab-active', null);
        this.$el.classList.remove('text-gray-400', 'hover:text-gray-600', 'dark:hover:text-gray-300');
        this.$el.classList.add('text-blue-500', 'dark:text-blue-400');

        // Update the custom properties
        this.updateIndicatorPosition();
      },
    }));
  });
</script>
